<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>System.IO.Utf8.Internal</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">with-utf8-1.0.2.4: Get your IO right on the first try</span><ul class="links" id="page-menu"><li><a href="src/System.IO.Utf8.Internal.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">System.IO.Utf8.Internal</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Internal functions that implement encoding selection logic.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:EncodingAction">EncodingAction</a><ul class="subs"><li>= <a href="#v:Keep">Keep</a></li><li>| <a href="#v:ChangeFromTo">ChangeFromTo</a> <a href="../base-4.18.2.0/GHC-IO-Encoding-Types.html#t:TextEncoding" title="GHC.IO.Encoding.Types">TextEncoding</a> <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></li></ul></li><li class="src short"><a href="#v:chooseBestEncPure">chooseBestEncPure</a> :: <a href="../base-4.18.2.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> -&gt; <a href="../base-4.18.2.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a> -&gt; <a href="../base-4.18.2.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></li><li class="src short"><a href="#v:chooseBestEnc">chooseBestEnc</a> :: <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; <a href="../base-4.18.2.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.2.0/GHC-IO-Encoding-Types.html#t:TextEncoding" title="GHC.IO.Encoding.Types">TextEncoding</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="System-IO-Utf8-Internal.html#t:EncodingAction" title="System.IO.Utf8.Internal">EncodingAction</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:EncodingAction" class="def">EncodingAction</a> <a href="src/System.IO.Utf8.Internal.html#EncodingAction" class="link">Source</a> <a href="#t:EncodingAction" class="selflink">#</a></p><div class="doc"><p>What to do with the encoding of the handle.</p><p>We return new encoding as string to simplify testing, because,
 it turns out, when you make an encoding with some name, the
 resulting encoding can have a different name.</p><p>The second constructor also contains the old encoding as a proof
 that the encoding is set to a new one only if there was a previous
 one in the first place. You probably think I am crazy, but I am not,
 it is just the simplest way to make the <code>hSetBestUtf8Enc</code> easy to write.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Keep" class="def">Keep</a></td><td class="doc"><p>Do nothing.</p></td></tr><tr><td class="src"><a id="v:ChangeFromTo" class="def">ChangeFromTo</a> <a href="../base-4.18.2.0/GHC-IO-Encoding-Types.html#t:TextEncoding" title="GHC.IO.Encoding.Types">TextEncoding</a> <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>Change the first encoding to the second.</p></td></tr></table></div></div><div class="top"><p class="src"><a id="v:chooseBestEncPure" class="def">chooseBestEncPure</a> <a href="src/System.IO.Utf8.Internal.html#chooseBestEncPure" class="link">Source</a> <a href="#v:chooseBestEncPure" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></td><td class="doc"><p>Is a terminal device?</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc"><p>Previous encoding name.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.2.0/Data-String.html#t:String" title="Data.String">String</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Pure version of <code><a href="System-IO-Utf8-Internal.html#v:chooseBestEnc" title="System.IO.Utf8.Internal">chooseBestEnc</a></code>.</p><p>This function is not actually used in the library. It exists only
 for documentation purposes to demonstrate the logic.
 It is also used in tests to verify that the logic implemented is
 indeed this.</p></div></div><div class="top"><p class="src"><a id="v:chooseBestEnc" class="def">chooseBestEnc</a> <a href="src/System.IO.Utf8.Internal.html#chooseBestEnc" class="link">Source</a> <a href="#v:chooseBestEnc" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></td><td class="doc"><p>Handle to choose encoding for.</p></td></tr><tr><td class="src">-&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="../base-4.18.2.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>)</td><td class="doc"><p>hIsTerminalDevice.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base-4.18.2.0/GHC-IO-Encoding-Types.html#t:TextEncoding" title="GHC.IO.Encoding.Types">TextEncoding</a></td><td class="doc"><p>Current encoding.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.18.2.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="System-IO-Utf8-Internal.html#t:EncodingAction" title="System.IO.Utf8.Internal">EncodingAction</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Choose the best encoding for a file handle.</p><p>This function implements the same logic as <code><a href="System-IO-Utf8-Internal.html#v:chooseBestEncPure" title="System.IO.Utf8.Internal">chooseBestEncPure</a></code>,
 but in a way that is more optimal in terms of IO queries. In
 particular:</p><ol><li value="1">It receives both a handle and its current encoding, because the
    calling function will, most likely, need to know the current encoding
    (e.g. to be able to restore it), so we avoid repeating the query.</li><li value="2">It first checks for the cases where it doesn't care whether the device
    is a terminal or not, so the query will be made only if really necessary.</li></ol></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>