<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>System.IO.Utf8</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">with-utf8-1.0.2.4: Get your IO right on the first try</span><ul class="links" id="page-menu"><li><a href="src/System.IO.Utf8.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">System.IO.Utf8</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Standard IO functions assume that the character encoding of the data
 they read or write is the same as the one used by the current locale. In many
 situtations this assumption is wrong, as tools work with files, and
 files nowadays are mostly UTF-8 encoded, regardless of the locale.
 Therefore, it is almost always a good idea to switch the encoding of
 file handles to UTF-8.</p><p>The same applies to standard input, output, and error handles. However,
 there is an edge-case: if they are attached to a terminal, and the
 current locale encoding is not UTF-8, using UTF-8 might actually be unsafe.</p><p>If you are developing an executable, in most cases, it is enough to
 configure the environment accordingly on program start, see the
 <a href="Main-Utf8.html">Main.Utf8</a> for functions that help with this.
 However, if you are a library author, you should avoid modifying the
 global environment.</p><h1>Quick start</h1><h2>Opening new files</h2><p>If you need to open a text file, use <code>Utf8.</code><code><a href="System-IO-Utf8.html#v:withFile" title="System.IO.Utf8">withFile</a></code>
 (or <code>Utf8.</code><code><a href="System-IO-Utf8.html#v:openFile" title="System.IO.Utf8">openFile</a></code>). These will not only open the file, but also
 set the handle&#8217;s encoding to UTF-8, regardless of the user&#8217;s locale.</p><h2>Working with existing handles</h2><p>Suppose you are creating a function which produces some text and writes
 it to a file handle that is passed to it from the outside.
 Ask yourself this question: do I want to encode this text in UTF-8
 or using the encoding from the user&#8217;s locale?</p><p>In many cases this question is easy to answer. For example, if your
 function produces Haskell code, then you always want it in UTF-8,
 because that is what all other tools (including GHC) expect.</p><p>In some cases it is not that clear. What you can do then is consider
 what the user is going to do with the data produced.
 If it is, primarily, meant to be displayed on their screen and then
 forgotten, you don&#8217;t need UTF-8. On the other hand, if it is meant
 to be saved somewhere and then used or edited by other tools, then
 you need UTF-8.</p><p>If you decided that your function needs to try to switch the handle
 to UTF-8, it is very easy to achieve:</p><pre>import qualified System.IO.Utf8 as Utf8

writeData :: <code><a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></code> -&gt; InputDataType -&gt; IO ()
writeData hOut inData = Utf8.<code><a href="System-IO-Utf8.html#v:withHandle" title="System.IO.Utf8">withHandle</a></code> hOut $ do
  {- ... write the data ...  -}
</pre><p>If you decided that you don&#8217;t need to try to switch it to UTF-8,
 replace <code>withHandle</code> with <code><a href="System-IO-Utf8.html#v:withTerminalHandle" title="System.IO.Utf8">withTerminalHandle</a></code> to only make the
 handle safe to write to without runtime errors.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:withHandle">withHandle</a> :: (<a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m) =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r -&gt; m r</li><li class="src short"><a href="#v:withTerminalHandle">withTerminalHandle</a> :: (<a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m) =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r -&gt; m r</li><li class="src short"><a href="#v:setHandleEncoding">setHandleEncoding</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m ()</li><li class="src short"><a href="#v:setTerminalHandleEncoding">setTerminalHandleEncoding</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m ()</li><li class="src short"><a href="#v:openFile">openFile</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.18.2.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; m <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a></li><li class="src short"><a href="#v:withFile">withFile</a> :: (<a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m) =&gt; <a href="../base-4.18.2.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:withHandle" class="def">withHandle</a> :: (<a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m) =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r -&gt; m r <a href="src/System.IO.Utf8.html#withHandle" class="link">Source</a> <a href="#v:withHandle" class="selflink">#</a></p><div class="doc"><p>Temporarily set handle encoding to the best possible.</p><p>&#8220;Best possible&#8221; means UTF-8, unless the handle points to a terminal
 device, in which case the encoding will be left the same, but tweaked
 to approximate unencodable characters.</p><p>This function is safe to call on handles open in binary mode and it will
 do nothing on them.</p><p>To sum up:</p><ul><li>If the handle is in binary mode, do nothing.</li><li>If the handle points to a terminal device, act like <code><a href="System-IO-Utf8.html#v:withTerminalHandle" title="System.IO.Utf8">withTerminalHandle</a></code>.</li><li>For regular files always choose UTF-8, of course.</li></ul></div></div><div class="top"><p class="src"><a id="v:withTerminalHandle" class="def">withTerminalHandle</a> :: (<a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m) =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r -&gt; m r <a href="src/System.IO.Utf8.html#withTerminalHandle" class="link">Source</a> <a href="#v:withTerminalHandle" class="selflink">#</a></p><div class="doc"><p>Temporarily make a handle safe to write any text to.</p><p>If the handle is not using UTF-8, adjust the encoding to remain the same
 as before, but approximate unencodable characters. When the action is done,
 restore it back to the previous one.</p><p>Use this function only if you are sure you want to treat this handle as
 a terminal (that is, you will be using it to interact with the user
 and to write user-visible messages, rather than something that can
 be reasonably expected to go to a file).</p><p>This function is safe to call on handles open in binary mode and it will
 do nothing on them.</p></div></div><div class="top"><p class="src"><a id="v:setHandleEncoding" class="def">setHandleEncoding</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m () <a href="src/System.IO.Utf8.html#setHandleEncoding" class="link">Source</a> <a href="#v:setHandleEncoding" class="selflink">#</a></p><div class="doc"><p>Set handle encoding to the best possible.</p><p>See <code><a href="System-IO-Utf8.html#v:withHandle" title="System.IO.Utf8">withHandle</a></code> for description and prefer it, if possible.</p></div></div><div class="top"><p class="src"><a id="v:setTerminalHandleEncoding" class="def">setTerminalHandleEncoding</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m () <a href="src/System.IO.Utf8.html#setTerminalHandleEncoding" class="link">Source</a> <a href="#v:setTerminalHandleEncoding" class="selflink">#</a></p><div class="doc"><p>Make a handle safe to write any text to.</p><p>See <code><a href="System-IO-Utf8.html#v:withTerminalHandle" title="System.IO.Utf8">withTerminalHandle</a></code> for description and prefer it, if possible.</p></div></div><div class="top"><p class="src"><a id="v:openFile" class="def">openFile</a> :: <a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m =&gt; <a href="../base-4.18.2.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; m <a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> <a href="src/System.IO.Utf8.html#openFile" class="link">Source</a> <a href="#v:openFile" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="../base-4.18.2.0/System-IO.html#v:openFile" title="System.IO">openFile</a></code>, but sets the file encoding to UTF-8, regardless
 of the current locale.</p></div></div><div class="top"><p class="src"><a id="v:withFile" class="def">withFile</a> :: (<a href="../base-4.18.2.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../exceptions-0.10.7/Control-Monad-Catch.html#t:MonadMask" title="Control.Monad.Catch">MonadMask</a> m) =&gt; <a href="../base-4.18.2.0/System-IO.html#t:FilePath" title="System.IO">FilePath</a> -&gt; <a href="../base-4.18.2.0/System-IO.html#t:IOMode" title="System.IO">IOMode</a> -&gt; (<a href="../base-4.18.2.0/GHC-IO-Handle.html#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; m r) -&gt; m r <a href="src/System.IO.Utf8.html#withFile" class="link">Source</a> <a href="#v:withFile" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="../base-4.18.2.0/System-IO.html#v:withFile" title="System.IO">withFile</a></code>, but sets the file encoding to UTF-8, regardless
 of the current locale.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>